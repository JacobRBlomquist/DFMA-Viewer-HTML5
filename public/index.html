<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Mukta&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <title>DFMA Map Viewer - HTML5 Canvas</title>
    <title>Document</title>
    <script src="pako.js"></script>
    <script src="p5.js"></script>
    <script src="site.js"></script>
    <script src="parser.js"></script>
    <script src="sketch.js"></script>


</head>

<body>
    <ul id="nav">
        <li><a href="https://blomquist.xyz" target=_blank>Home</a></li>
        <li><a href="https://mkv25.net/dfma" target=_blank>DFMA</a></li>
        <li><a href="https://bay12games.com/dwarves" target=_blank>Dwarf Fortress Home</a></li>
    </ul>
    <div class="container">
        <h1>DFMA Map Viewer</h1>

        <p>Drag and Drop an <em>FDF-MAP</em> file to open.</p>

      
        <div id="canvas_container">
            <!-- P5.js Canvas goes here -->
        </div>
        <span id="status"></span>
        <p>Extracted Tiles from: <span id="fileName"></span></p>
        <hr>
        <h2>Controls:</h2>
        <ul>
            <li>Move Map
                <ul>
                    <li>Click and Drag</li>
                    <li>Use the <kbd>8</kbd><kbd>6</kbd><kbd>4</kbd><kbd>2</kbd> keys to move one tile at a time.</li>
                    <li>Hold the <kbd>z</kbd> key to move by 10 tiles at a time <br>(Shift doesn't work due to the DOM wanting to scroll the entire window when holding shift)</li>
                </ul>
            </li>
            <li>Zoom<ul>
                    <li>
                        Zoom out: <kbd>-</kbd>
                    </li>
                    <li>Zoom in: <kbd>+</kbd> or <kbd>=</kbd></li>
                </ul>
            </li>
            <li>Change Layer <ul>
                    <li>Up: <kbd>&lt;</kbd> or <kbd>,</kbd></li>
                    <li>Down: <kbd>&gt;</kbd> or <kbd>.</kbd></li>
                </ul>
            </li>
        </ul>
        <hr>
        <h3>About:</h3>
        <p>This viewer was created using <a href="https://www.p5js.org" target="_blank">P5.js</a>. The parser for the
            FDF-MAP files is written
            in pure ES6 javascript.</p>
        <a href="https://github.com/JacobRBlomquist/DFMA-Viewer-HTML5" target="_blank">View Code</a>
        <hr>
        <h3>Changelog</h3>
        <ul>
            <li>
                <strong>TODO</strong>
                <ul>
                    <li>Side / Front View (as in flash version)</li>
                    <li>UI Controls (Mostly for mobile)</li>
                    <li>Repeating input when holding down movement keys (utilize acceleration so it doesn't happen instantly and
                        slowly speeds up.)
                    </li>
                </ul>
            </li>
            <li>
                29 May 2020
                <ul>
                    <li>
                        Implemented an internal "ZoomTo" function. The function takes the following parameters:
                        <ul>
                            <li>layer - layer to zoom to (i.e. layer 76)</li>
                            <li>scale - zoom level (same as page zoom level)</li>
                            <li>xTile - x Coordinate of tile to zoom to (Starts at 0)</li>
                            <li>yTile - y Coordinate of tile to zoom to (starts at 0)</li>
                        </ul>
                        If an invalid layer is given, nothing happens.
                    </li>
                    <li>
                        Added keyboard only movement. The numpad <kbd>8,6,4,2</kbd> keys will move one tile at a time. And holding the <kbd>z</kbd>
                        key will make the movement with the numpad move by 10 each press.
                    </li>
                </ul>
            </li>
            <li>
                4 May 2020
                <ul>
                    <li>
                        Fixed small hang when initially loading map. (Entire DOM was freezing when parsing individual
                        layers.)
                        <ul>
                            <li>Javascript Promises were used to make this async so that DOM updates could occur.</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                1 May 2020
                <ul>
                    <li>Fixed slow parsing. Manually manipulated each color channel (RGBA) of the image. MUCH faster.
                    </li>
                    <li>Contacted Markavian with initial product.</li>
                </ul>
            </li>
            <li>
                30 April 2020
                <ul>
                    <li>
                        Implemented map parsing fully.
                    </li>
                    <li>Smooth zooming</li>
                    <li>
                        Parsing is SUPER SLOW! Most likely due to using P5.Image's 'set' function.
                    </li>
                </ul>
            </li>
            <li>
                29 April 2020
                <ul>
                    <li>
                        Initial Commit.
                    </li>
                    <li>
                        Basic Tile Viewing. (This version just gets a map and displays its tiles.)
                    </li>
                </ul>
            </li>
        </ul>
        <hr>
        <footer>
            <p>&copy; 2020 Jacob Blomquist</p>
            <p>Licensed Under MIT</p>
        </footer>
    </div>
</body>


</html>